# Change Log

### Unreleased

* Change the default mechanism for scheduling macro tasks to use `MessageChannel.send` as it is less likely to
  be throttled by the browser when in a background thread when compared to `setTimeout(...)` style scheduling
  and it seems to have less jitter. See the explainer [article](https://www.tenforums.com/tutorials/80233-enable-disable-google-chrome-background-tab-throttling-windows.html) for some details about
  how chrome throttles some timers. The scheduler can use revert to using `setTimeout(...)` by specifying the
  compile time setting `zemeckis.use_message_channel_to_schedule_tasks` to `false`.
* Improve the clairty of the `Zemeckis` javadocs.
* Change the default mechanism for scheduling delayed and periodic tasks so that the tasks are scheduled
  within a `WebWorker` and the web worker sends a message to the main thread to to trigger the task. This
  results in a more stable scheduling at the expense of additional code complexity and code size. This also
  eliminates throttling that occurs when the browser tab is in the background. See the [article](https://medium.com/teads-engineering/the-most-accurate-way-to-schedule-a-function-in-a-web-browser-eadcd164da12)
  for measurements carried out by another party that validates this approach. The toolkit can use revert
  to using `setTimeout(...)` and `setInterval(...)` by specifying the compile time setting
  `zemeckis.use_worker_to_schedule_delayed_tasks` to `false`.

### [v0.05](https://github.com/realityforge/zemeckis/tree/v0.05) (2021-01-07) · [Full Changelog](https://github.com/realityforge/zemeckis/compare/v0.04...v0.05)

Changes in this release:

* Decouple `ZemeckisConfig` from GWT libraries to make it compatible with J2CL.

### [v0.04](https://github.com/realityforge/zemeckis/tree/v0.04) (2021-01-06) · [Full Changelog](https://github.com/realityforge/zemeckis/compare/v0.03...v0.04)

The release includes 22 non breaking API changes, 1 potentially breaking API change and 2 breaking API changes.

Changes in this release:

* Move all methods from the `Schedule` class to the `Zemeckis` class.
* Rework the `Zemeckis.macroTask(...)`, `Zemeckis.microTask(...)`, `Zemeckis.animationFrame(...)`, `Zemeckis.afterFrame(...)` and `Zemeckis.onIdle(...)` methods so that they return a `Cancelable` that can be used to abort the scheduled task before it executes.
* Make it possible to specify a human-readable name for a task when scheduling a task. Names are only supported if the `Zemeckis.areNamesEnabled()` returns true which is controlled by the compile time parameter `zemeckis.enable_names`.
* Add `grim` annotations to make it easy to assert which parts of code is expected to be optimized away in different builds.

### [v0.03](https://github.com/realityforge/zemeckis/tree/v0.03) (2021-01-05) · [Full Changelog](https://github.com/realityforge/zemeckis/compare/v0.02...v0.03)

The release includes 2 non breaking API changes and 3 breaking API changes.

Changes in this release:

* Fix the invariant message generated by `Schedule.periodicTask(...)` to indicate that `0` is not a valid period.
* Rename the method `Scheduler.schedule(...)` to `Scheduler.delayedTask(...)`.
* Rename the method `Scheduler.scheduleAtFixedRate(...)` to `Scheduler.periodicTask(...)`.
* Rework the `Scheduler.delayedTask(...)` and `Scheduler.periodicTask(...)` methods to call `becomeMacroTask(...)` to wrap supplied task. This will result in tasks scheduled with a delay and tasks scheduled via `Scheduler.macroTask(...)` behaving the same way.
* Remove `Schedule.becomeMacroTask(...)` from the public API as should not be needed now that `delayedTask` and `periodicTask` methods invoke this method internally.

### [v0.02](https://github.com/realityforge/zemeckis/tree/v0.02) (2020-12-31) · [Full Changelog](https://github.com/realityforge/zemeckis/compare/v0.01...v0.02)

Changes in this release:

* Fix bug that resulted in micro tasks not being scheduled.
* Fix bug that resulted in afterFrame tasks not being scheduled.

### [v0.01](https://github.com/realityforge/zemeckis/tree/v0.01) (2020-12-31) · [Full Changelog](https://github.com/realityforge/zemeckis/compare/aabdb6891ff2bc9f21417aab5e9ab7492173a361...v0.01)

 🎉 Initial release 🎉
